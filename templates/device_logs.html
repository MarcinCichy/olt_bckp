{% extends "base.html" %}
{% block title %}Logi urzÄ…dzenia {{ device.ip }}{% endblock %}

{% block content %}
<h2 class="h5 mb-3">Logi urzÄ…dzenia: {{ device.ip }}</h2>

<p class="mb-2">
    <a class="btn btn-link btn-sm text-light p-0" href="{{ url_for('index') }}">â† WrÃ³Ä‡ do listy urzÄ…dzeÅ„</a>
</p>

<div class="card mb-4 border-secondary">
    <div class="card-header">Aktualny status urzÄ…dzenia</div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <strong>Ostatni wynik:</strong><br>
                {% if device.last_status == 'success' %}
                    <span class="text-success fs-5">âœ… Sukces</span>
                {% elif device.last_status == 'running' %}
                    <span class="text-warning fs-5">â³ W toku</span>
                {% elif device.last_status == 'error' %}
                    <span class="text-danger fs-5">âŒ BÅ‚Ä…d</span>
                {% else %}
                    <span class="text-muted">Brak danych</span>
                {% endif %}
            </div>
            <div class="col-md-4">
                <strong>Ostatni backup:</strong><br>
                {% if device.last_backup_time %}
                    {{ device.last_backup_time.strftime('%Y-%m-%d %H:%M') }}
                {% else %}
                    <span class="text-muted">nigdy</span>
                {% endif %}
            </div>
            <div class="col-md-4">
                <strong>Ostatni komunikat bÅ‚Ä™du:</strong><br>
                {% if device.last_error %}
                    <span class="text-danger">{{ device.last_error }}</span>
                {% else %}
                    <span class="text-muted">-</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<h3 class="h6 mt-3">Historia operacji</h3>

{% if logs %}
<table class="table table-sm table-striped table-hover align-middle olt-table">
    <thead>
        <tr>
            <th>Data</th>
            <th>Nazwa pliku</th>
            <th>Status</th>
            <th>Rozmiar</th>
            <th>Szyfrowany</th>
            <th>Akcje</th>
        </tr>
    </thead>
    <tbody>
    {% for log in logs %}
        <tr>
            <td>{{ log.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td class="font-monospace small">{{ log.filename }}</td>
            <td>
                {% if log.status == 'success' %}
                    <span class="badge bg-success">OK</span>
                {% else %}
                    <span class="badge bg-danger">BÅÄ„D</span>
                {% endif %}
            </td>
            <td>{{ log.size_bytes }} B</td>
            <td>{{ "ğŸ”’ Tak" if log.encrypted else "ğŸ”“ Nie" }}</td>

            <td class="text-nowrap">
                <div class="d-flex flex-row gap-2">
                    {% if log.status == 'success' %}
                        <a class="btn btn-sm btn-outline-primary"
                           href="{{ url_for('view_backup', log_id=log.id) }}"
                           title="PodglÄ…d">ğŸ‘ï¸</a>
                        <a class="btn btn-sm btn-outline-success"
                           href="{{ url_for('download_backup', log_id=log.id) }}"
                           title="Pobierz">ğŸ’¾</a>
                    {% else %}
                        <span style="display:inline-block; width: 66px;"></span>
                    {% endif %}

                    <form class="d-inline" method="post" action="{{ url_for('delete_backup', log_id=log.id) }}"
                          onsubmit="return confirm('UsunÄ…Ä‡ ten wpis?');">
                        <button type="submit" class="btn btn-sm btn-outline-danger" title="UsuÅ„">ğŸ—‘ï¸</button>
                    </form>
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-secondary">Brak historii dla tego urzÄ…dzenia.</div>
{% endif %}

{% endblock %}